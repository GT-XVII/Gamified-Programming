\doxysection{Downscoped\+Client Class Reference}
\hypertarget{class_downscoped_client}{}\label{class_downscoped_client}\index{DownscopedClient@{DownscopedClient}}


Inheritance diagram for Downscoped\+Client\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=221pt]{class_downscoped_client__inherit__graph}
\end{center}
\end{figure}


Collaboration diagram for Downscoped\+Client\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=221pt]{class_downscoped_client__coll__graph}
\end{center}
\end{figure}
\doxysubsubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{class_downscoped_client_a114d5da4fd2ae44058441c0f77142675}{constructor}} (auth\+Client, credential\+Access\+Boundary, additional\+Options, quota\+Project\+Id)
\item 
\mbox{\hyperlink{class_downscoped_client_aa4f3dcaf85a70004c7c3731423abc938}{set\+Credentials}} (\mbox{\hyperlink{_0dgrpc_2grpc-js_2build_2src_2index_8js_a88f1ca34064fef6dc1e29d7d1cf5cfcf}{credentials}})
\item 
\mbox{\hyperlink{util_2dist_2index_8cjs_8js_af516a86cc3f563f4c12f98f31f1e2e57}{async}} \mbox{\hyperlink{class_downscoped_client_a571e5a1011136479ad16463cd74c77cf}{get\+Access\+Token}} ()
\item 
\mbox{\hyperlink{util_2dist_2index_8cjs_8js_af516a86cc3f563f4c12f98f31f1e2e57}{async}} \mbox{\hyperlink{class_downscoped_client_a6082bacd6db45ecf8f6bb92b7513a1f8}{get\+Request\+Headers}} ()
\item 
\mbox{\hyperlink{class_downscoped_client_ac2a791fe5fdd6375d028e117c92d6dcf}{request}} (opts, \mbox{\hyperlink{database-compat_2dist_2index_8standalone_8js_a622460feeccdab6d8f307936fc6b36fb}{callback}})
\item 
\mbox{\hyperlink{util_2dist_2index_8cjs_8js_af516a86cc3f563f4c12f98f31f1e2e57}{async}} \mbox{\hyperlink{class_downscoped_client_a402a18e315105a2d8f476d53b917b946}{request\+Async}} (opts, re\+Auth\+Retried=\mbox{\hyperlink{database-compat_2dist_2index_8standalone_8js_a5df37b7f02e5cdc7d9412b7f872b8e01}{false}})
\item 
\mbox{\hyperlink{util_2dist_2index_8cjs_8js_af516a86cc3f563f4c12f98f31f1e2e57}{async}} \mbox{\hyperlink{class_downscoped_client_ad98aae2e6619b36e3078e591348d432e}{refresh\+Access\+Token\+Async}} ()
\item 
\mbox{\hyperlink{class_downscoped_client_a2bb5b4957b8c83e505fc99f0da720ebe}{is\+Expired}} (downscoped\+Access\+Token)
\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
Defines a set of Google credentials that are downscoped from an existing set of Google OAuth2 credentials. This is useful to restrict the Identity and Access Management (IAM) permissions that a short-\/lived credential can use. The common pattern of usage is to have a token broker with elevated access generate these downscoped credentials from higher access source credentials and pass the downscoped short-\/lived access tokens to a token consumer via some secure authenticated channel for limited access to Google Cloud \doxylink{class_storage}{Storage} resources. 

\doxysubsection{Member Function Documentation}
\Hypertarget{class_downscoped_client_a114d5da4fd2ae44058441c0f77142675}\index{DownscopedClient@{DownscopedClient}!constructor@{constructor}}
\index{constructor@{constructor}!DownscopedClient@{DownscopedClient}}
\doxysubsubsection{\texorpdfstring{constructor()}{constructor()}}
{\footnotesize\ttfamily \label{class_downscoped_client_a114d5da4fd2ae44058441c0f77142675} 
Downscoped\+Client\+::constructor (\begin{DoxyParamCaption}\item[{}]{auth\+Client}{, }\item[{}]{credential\+Access\+Boundary}{, }\item[{}]{additional\+Options}{, }\item[{}]{quota\+Project\+Id}{}\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}

Instantiates a downscoped client object using the provided source \doxylink{class_auth_client}{Auth\+Client} and credential access boundary rules. To downscope permissions of a source \doxylink{class_auth_client}{Auth\+Client}, a Credential Access Boundary that specifies which resources the new credential can access, as well as an upper bound on the permissions that are available on each resource, has to be defined. \doxylink{class_a}{A} downscoped client can then be instantiated using the source \doxylink{class_auth_client}{Auth\+Client} and the Credential Access Boundary. 
\begin{DoxyParams}{Parameters}
{\em auth\+Client} & The source \doxylink{class_auth_client}{Auth\+Client} to be downscoped based on the provided Credential Access Boundary rules. \\
\hline
{\em credential\+Access\+Boundary} & The Credential Access Boundary which contains a list of access boundary rules. Each rule contains information on the resource that the rule applies to, the upper bound of the permissions that are available on that resource and an optional condition to further restrict permissions. \\
\hline
{\em additional\+Options} & {\bfseries{DEPRECATED, set this in the provided {\ttfamily auth\+Client}.}} Optional additional behavior customization options. \\
\hline
{\em quota\+Project\+Id} & {\bfseries{DEPRECATED, set this in the provided {\ttfamily auth\+Client}.}} Optional quota project id for setting up in the x-\/goog-\/user-\/project header. \\
\hline
\end{DoxyParams}


References \mbox{\hyperlink{form_8js_ab63a7754967c678e14c9ece9cf96be37}{\$}}, \mbox{\hyperlink{database-compat_2dist_2index_8standalone_8js_aa4072ba4b6b56b0fb6f4801f17ab2b34}{exports}}, \mbox{\hyperlink{agent-base_2dist_2helpers_8js_ab3093f9d8507c035b404b9d49bdb40f7}{https}}, \mbox{\hyperlink{cjs_2internal_2observable_2of_8js_afd9e33601da8812842c6288b48c17f0a}{of}}, and \mbox{\hyperlink{downscopedclient_8js_aed84e6a8dd47163697d602a45f4cf675}{sts}}.

\Hypertarget{class_downscoped_client_a571e5a1011136479ad16463cd74c77cf}\index{DownscopedClient@{DownscopedClient}!getAccessToken@{getAccessToken}}
\index{getAccessToken@{getAccessToken}!DownscopedClient@{DownscopedClient}}
\doxysubsubsection{\texorpdfstring{getAccessToken()}{getAccessToken()}}
{\footnotesize\ttfamily \label{class_downscoped_client_a571e5a1011136479ad16463cd74c77cf} 
\mbox{\hyperlink{util_2dist_2index_8cjs_8js_af516a86cc3f563f4c12f98f31f1e2e57}{async}} Downscoped\+Client\+::get\+Access\+Token (\begin{DoxyParamCaption}{}{}\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}



References \mbox{\hyperlink{class_downscoped_client_a2bb5b4957b8c83e505fc99f0da720ebe}{is\+Expired()}}, \mbox{\hyperlink{class_downscoped_client_ad98aae2e6619b36e3078e591348d432e}{refresh\+Access\+Token\+Async()}}, \mbox{\hyperlink{express_2lib_2express_8js_abde3c35e3bb7e5225dd7f234c685329c}{res}}, and \mbox{\hyperlink{util_2dist_2index_8cjs_8js_a87da3d8264af1c9427605148f20dd9c4}{token}}.

Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{class_downscoped_client_a571e5a1011136479ad16463cd74c77cf_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{class_downscoped_client_a571e5a1011136479ad16463cd74c77cf_icgraph}
\end{center}
\end{figure}
\Hypertarget{class_downscoped_client_a6082bacd6db45ecf8f6bb92b7513a1f8}\index{DownscopedClient@{DownscopedClient}!getRequestHeaders@{getRequestHeaders}}
\index{getRequestHeaders@{getRequestHeaders}!DownscopedClient@{DownscopedClient}}
\doxysubsubsection{\texorpdfstring{getRequestHeaders()}{getRequestHeaders()}}
{\footnotesize\ttfamily \label{class_downscoped_client_a6082bacd6db45ecf8f6bb92b7513a1f8} 
\mbox{\hyperlink{util_2dist_2index_8cjs_8js_af516a86cc3f563f4c12f98f31f1e2e57}{async}} Downscoped\+Client\+::get\+Request\+Headers (\begin{DoxyParamCaption}{}{}\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}

The main authentication interface. It takes an optional url which when present is the endpoint being accessed, and returns a Promise which resolves with authorization header fields.

The result has the form\+: \{ Authorization\+: \textquotesingle{}Bearer $<$access\+\_\+token\+\_\+value$>$\textquotesingle{} \} 

References \mbox{\hyperlink{form_8js_ab63a7754967c678e14c9ece9cf96be37}{\$}}, \mbox{\hyperlink{class_downscoped_client_a571e5a1011136479ad16463cd74c77cf}{get\+Access\+Token()}}, and \mbox{\hyperlink{database-compat_2dist_2index_8standalone_8js_a7f2cb2fcdd79bf72cefd29b7bc2d10fa}{headers}}.

Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{class_downscoped_client_a6082bacd6db45ecf8f6bb92b7513a1f8_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{class_downscoped_client_a6082bacd6db45ecf8f6bb92b7513a1f8_icgraph}
\end{center}
\end{figure}
\Hypertarget{class_downscoped_client_a2bb5b4957b8c83e505fc99f0da720ebe}\index{DownscopedClient@{DownscopedClient}!isExpired@{isExpired}}
\index{isExpired@{isExpired}!DownscopedClient@{DownscopedClient}}
\doxysubsubsection{\texorpdfstring{isExpired()}{isExpired()}}
{\footnotesize\ttfamily \label{class_downscoped_client_a2bb5b4957b8c83e505fc99f0da720ebe} 
Downscoped\+Client\+::is\+Expired (\begin{DoxyParamCaption}\item[{}]{downscoped\+Access\+Token}{}\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}

Returns whether the provided credentials are expired or not. If there is no expiry time, assumes the token is not expired or expiring. 
\begin{DoxyParams}{Parameters}
{\em downscoped\+Access\+Token} & The credentials to check for expiration. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Whether the credentials are expired or not. 
\end{DoxyReturn}


References \mbox{\hyperlink{lodash_2debounce_8js_ae2dc5120e9ccb39c5ef94d5c203e534a}{now}}.

Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{class_downscoped_client_a2bb5b4957b8c83e505fc99f0da720ebe_icgraph}
\end{center}
\end{figure}
\Hypertarget{class_downscoped_client_ad98aae2e6619b36e3078e591348d432e}\index{DownscopedClient@{DownscopedClient}!refreshAccessTokenAsync@{refreshAccessTokenAsync}}
\index{refreshAccessTokenAsync@{refreshAccessTokenAsync}!DownscopedClient@{DownscopedClient}}
\doxysubsubsection{\texorpdfstring{refreshAccessTokenAsync()}{refreshAccessTokenAsync()}}
{\footnotesize\ttfamily \label{class_downscoped_client_ad98aae2e6619b36e3078e591348d432e} 
\mbox{\hyperlink{util_2dist_2index_8cjs_8js_af516a86cc3f563f4c12f98f31f1e2e57}{async}} Downscoped\+Client\+::refresh\+Access\+Token\+Async (\begin{DoxyParamCaption}{}{}\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}

Forces token refresh, even if unexpired tokens are currently cached. GCP access tokens are retrieved from authclient object/source credential. Then GCP access tokens are exchanged for downscoped access tokens via the token exchange endpoint. \begin{DoxyReturn}{Returns}
\doxylink{class_a}{A} promise that resolves with the fresh downscoped access token. 
\end{DoxyReturn}
The STS endpoint will only return the expiration time for the downscoped access token if the original access token represents a service account. The downscoped token\textquotesingle{}s expiration time will always match the source credential expiration. When no expires\+\_\+in is returned, we can copy the source credential\textquotesingle{}s expiration time.

References \mbox{\hyperlink{logger_2dist_2esm_2index_8esm5_8js_a0adf123df8967a14b5bdd9ff3bbe2d0c}{\+\_\+a}}, \mbox{\hyperlink{_0dgrpc_2grpc-js_2build_2src_2index_8js_a88f1ca34064fef6dc1e29d7d1cf5cfcf}{credentials}}, \mbox{\hyperlink{_0dprotobufjs_2eventemitter_2index_8js_a16439605b9cd7bd34fdbf935bef49de6}{emit}}, \mbox{\hyperlink{express_2lib_2express_8js_abde3c35e3bb7e5225dd7f234c685329c}{res}}, \mbox{\hyperlink{downscopedclient_8js_a9e961b123750db457d1dfdd601a5922f}{STS\+\_\+\+GRANT\+\_\+\+TYPE}}, \mbox{\hyperlink{downscopedclient_8js_abd38bae0d786fc063e9e0870dd3c3cb7}{STS\+\_\+\+REQUEST\+\_\+\+TOKEN\+\_\+\+TYPE}}, \mbox{\hyperlink{downscopedclient_8js_ac3b42142a5129403d0e7c36000d47234}{STS\+\_\+\+SUBJECT\+\_\+\+TOKEN\+\_\+\+TYPE}}, and \mbox{\hyperlink{get-intrinsic_2index_8js_ae6aa4817f0f49345b718ea6b4abae197}{undefined}}.

Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{class_downscoped_client_ad98aae2e6619b36e3078e591348d432e_icgraph}
\end{center}
\end{figure}
\Hypertarget{class_downscoped_client_ac2a791fe5fdd6375d028e117c92d6dcf}\index{DownscopedClient@{DownscopedClient}!request@{request}}
\index{request@{request}!DownscopedClient@{DownscopedClient}}
\doxysubsubsection{\texorpdfstring{request()}{request()}}
{\footnotesize\ttfamily \label{class_downscoped_client_ac2a791fe5fdd6375d028e117c92d6dcf} 
Downscoped\+Client\+::request (\begin{DoxyParamCaption}\item[{}]{opts}{, }\item[{}]{callback}{}\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}



References \mbox{\hyperlink{database-compat_2dist_2index_8standalone_8js_a622460feeccdab6d8f307936fc6b36fb}{callback}}, \mbox{\hyperlink{firestore__admin__v1__proto__api_8js_a08a4415e9d594ff960030b921d42b91e}{e}}, \mbox{\hyperlink{uuid_8min_8js_aaa5fef39529cdffdfa257202bb4fda9f}{r}}, and \mbox{\hyperlink{class_downscoped_client_a402a18e315105a2d8f476d53b917b946}{request\+Async()}}.

Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{class_downscoped_client_ac2a791fe5fdd6375d028e117c92d6dcf_cgraph}
\end{center}
\end{figure}
\Hypertarget{class_downscoped_client_a402a18e315105a2d8f476d53b917b946}\index{DownscopedClient@{DownscopedClient}!requestAsync@{requestAsync}}
\index{requestAsync@{requestAsync}!DownscopedClient@{DownscopedClient}}
\doxysubsubsection{\texorpdfstring{requestAsync()}{requestAsync()}}
{\footnotesize\ttfamily \label{class_downscoped_client_a402a18e315105a2d8f476d53b917b946} 
\mbox{\hyperlink{util_2dist_2index_8cjs_8js_af516a86cc3f563f4c12f98f31f1e2e57}{async}} Downscoped\+Client\+::request\+Async (\begin{DoxyParamCaption}\item[{}]{opts}{, }\item[{}]{re\+Auth\+Retried}{ = {\ttfamily \mbox{\hyperlink{database-compat_2dist_2index_8standalone_8js_a5df37b7f02e5cdc7d9412b7f872b8e01}{false}}}}\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}

Authenticates the provided HTTP request, processes it and resolves with the returned response. 
\begin{DoxyParams}{Parameters}
{\em opts} & The HTTP request options. \\
\hline
{\em re\+Auth\+Retried} & Whether the current attempt is a retry after a failed attempt due to an auth failure \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
\doxylink{class_a}{A} promise that resolves with the successful response. 
\end{DoxyReturn}


References \mbox{\hyperlink{firestore__admin__v1__proto__api_8js_a08a4415e9d594ff960030b921d42b91e}{e}}, \mbox{\hyperlink{class_downscoped_client_a6082bacd6db45ecf8f6bb92b7513a1f8}{get\+Request\+Headers()}}, \mbox{\hyperlink{cjs_2internal_2ajax_2ajax_8js_a45744f6308afbbcefdd2479b2c4bd5c5}{is\+Readable\+Stream()}}, \mbox{\hyperlink{class_downscoped_client_ad98aae2e6619b36e3078e591348d432e}{refresh\+Access\+Token\+Async()}}, \mbox{\hyperlink{class_downscoped_client_a402a18e315105a2d8f476d53b917b946}{request\+Async()}}, \mbox{\hyperlink{express_2lib_2express_8js_abde3c35e3bb7e5225dd7f234c685329c}{res}}, \mbox{\hyperlink{database-compat_2dist_2index_8standalone_8js_ac70ac40ef8199c59316b35022dd21914}{response}}, and \mbox{\hyperlink{downscopedclient_8js_ae3aac9dcd83d0a6524a3db7f78ecdce3}{stream}}.

Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{class_downscoped_client_a402a18e315105a2d8f476d53b917b946_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{class_downscoped_client_a402a18e315105a2d8f476d53b917b946_icgraph}
\end{center}
\end{figure}
\Hypertarget{class_downscoped_client_aa4f3dcaf85a70004c7c3731423abc938}\index{DownscopedClient@{DownscopedClient}!setCredentials@{setCredentials}}
\index{setCredentials@{setCredentials}!DownscopedClient@{DownscopedClient}}
\doxysubsubsection{\texorpdfstring{setCredentials()}{setCredentials()}}
{\footnotesize\ttfamily \label{class_downscoped_client_aa4f3dcaf85a70004c7c3731423abc938} 
Downscoped\+Client\+::set\+Credentials (\begin{DoxyParamCaption}\item[{}]{credentials}{}\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}

Provides a mechanism to inject Downscoped access tokens directly. The expiry\+\_\+date field is required to facilitate determination of the token expiration which would make it easier for the token consumer to handle. 
\begin{DoxyParams}{Parameters}
{\em credentials} & The Credentials object to set on the current client. \\
\hline
\end{DoxyParams}


References \mbox{\hyperlink{_0dgrpc_2grpc-js_2build_2src_2index_8js_a88f1ca34064fef6dc1e29d7d1cf5cfcf}{credentials}}.



The documentation for this class was generated from the following file\+:\begin{DoxyCompactItemize}
\item 
backend/node\+\_\+modules/google-\/auth-\/library/build/src/auth/\mbox{\hyperlink{downscopedclient_8js}{downscopedclient.\+js}}\end{DoxyCompactItemize}
